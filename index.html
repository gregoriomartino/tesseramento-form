<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modulo di Tesseramento</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
.container { max-width:600px; margin:40px auto; background:#fff; padding:30px; border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,0.08); }
h1 { text-align:center; margin-bottom:20px; color:#333; }
label { display:block; margin-top:18px; font-weight:600; color:#444; }
input, textarea { width:100%; padding:12px; margin-top:6px; border:1px solid #ccc; border-radius:8px; }
button { width:100%; padding:14px; margin-top:30px; background:#007bff; color:white; border:none; border-radius:10px; cursor:pointer; font-weight:600; }
button:hover { background:#0056b3; }
.checkbox-line { margin-top:10px; }
.paypal { text-align:center; margin-top:25px; }
.paypal a { color:#007bff; font-weight:600; text-decoration:none; }
</style>
</head>
<body>

<div class="container">
<h1>Modulo di Tesseramento</h1>

<form id="tesseramentoForm">

<label>1. Cognome</label>
<input type="text" name="cognome" required>

<label>2. Nome</label>
<input type="text" name="nome" required>

<label>3. Luogo di nascita</label>
<input type="text" name="luogo_nascita" required>

<label>4. Data di nascita</label>
<input type="date" name="data_nascita" required>

<label>5. E-mail</label>
<input type="email" name="email" required>

<label>6. Telefono (facoltativo)</label>
<input type="tel" name="telefono" placeholder="Riceverai aggiornamenti via WhatsApp">

<label>7. Consenso GDPR (obbligatorio)</label>
<div class="checkbox-line">
<input type="checkbox" name="gdpr_obbligatorio" required> Autorizzo il trattamento dei dati
</div>

<label>8. Consenso promozionale (facoltativo)</label>
<div class="checkbox-line">
<input type="checkbox" name="gdpr_promozionale"> Acconsento alle comunicazioni promozionali
</div>

<div class="paypal">
<p>9. Paga la quota con PayPal (facoltativo)</p>
<a href="https://paypal.me/provocard" target="_blank">Clicca qui per pagare</a>
</div>

<button type="submit">Invia</button>
</form>

<div id="message" style="text-align:center;margin-top:15px;color:green;font-weight:600;"></div>

</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxY2_U2mLyk0LV3kCK28FCR45NJ297a6Uch4zdY0drQZkdpvUkjUNq29853BmKhHhBqHw/exec";

document.getElementById("tesseramentoForm").addEventListener("submit", async function(e){
    e.preventDefault();

    const dati = {
        cognome: document.querySelector('[name="cognome"]').value,
        nome: document.querySelector('[name="nome"]').value,
        luogo_nascita: document.querySelector('[name="luogo_nascita"]').value,
        data_nascita: document.querySelector('[name="data_nascita"]').value,
        email: document.querySelector('[name="email"]').value,
        telefono: document.querySelector('[name="telefono"]').value,
        gdpr_obbligatorio: document.querySelector('[name="gdpr_obbligatorio"]').checked ? "SI" : "NO",
        gdpr_promozionale: document.querySelector('[name="gdpr_promozionale"]').checked ? "SI" : "NO"
    };

    // Salva CSV locale
    const csv = Object.keys(dati).join(",") + "\n" + Object.values(dati).join(",");
    const blob = new Blob([csv], {type:'text/csv'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'tesseramento.csv';
    a.click();

    // Invia a Google Sheets
    try {
        await fetch(SCRIPT_URL, {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify(dati)
        });
        document.getElementById("message").innerText = "âœ“ Invio riuscito!";
        this.reset();
    } catch(err) {
        document.getElementById("message").innerText = "Errore nell'invio";
        console.error(err);
    }
});
</script>

</body>
</html>
